# temporal-graph-gen

Pre-trained model and supporting scripts for [Neural Language Modeling for Contextualized Temporal Graph Generation](https://www.aclweb.org/anthology/2021.naacl-main.67/)


![Temporal Graph Generation](task.png)


## Temporal Graph Generation

1. Download pre-trained model [here](https://drive.google.com/file/d/161wl_sxlghXfWmR6917CdbqTMDIGOHaq/view?usp=sharing).


2. Prepare an input ``jsonl`` file. Each line of this file should be a ``json`` with the input text present in key "text":
```json
{"text": "text1"}
{"text": "text2"}
.
.
.
{"text": "textN"}
```

3. Run generation using:
```sh
python src/generate.py --model-path <path-to-model-checkpoint>\
                       --use-finetuned True\
                       --input-path <path-to-input-jsonl-file>\
                       --output-path <path-to-output-jsonl-file>
```
Where:
  - `path-to-model-checkpoint`: path to the pre-trained model downloaded in step 1.
  - `path-to-input-jsonl-file`: path to the input file prepared in step 2.
  - `path-to-output-jsonl-file`: path to the output file. The output file contains a temporal graph corresponding to each line of text in the input.


## Example
Input (data/test_input.json)
```
{"text": "That , in turn , is thought to have ties to the Party of God , a better-known guerrilla faction inspired by revolutionary Iran . The Organization of the Oppressed on Earth , asserted responsibility for the June 1985 hijacking of a Trans World Airways jetliner in which a United States Navy diver , Robert D. Stethem , was killed . It is not known where Colonel Higgins is being held ."}
```

Generation:
```sh
python src/run_generation.py --model-path data/model-checkpoints/temporal-graph-gen/\
  --use-finetuned True\
  --input-path test.json\
  --output-path test_output.json 
```

Output:
```
{"text": "That , in turn , is thought to have ties to the Party of God , a better-known guerrilla faction inspired by revolutionary Iran . The Organization of the Oppressed on Earth , asserted responsibility for the June 1985 hijacking of a Trans World Airways jetliner in which a United States Navy diver , Robert D. Stethem , was killed . It is not known where Colonel Higgins is being held .", "temporal_graph": "strict graph  {\n\"The Organization asserted responsibility\" -- \"a United States Navy diver killed\"  [rel=after];\n}"}
```

## Parsing Temporal Graphs
The temporal graphs are generated in the [DOT](https://graphviz.org/doc/info/lang.html) language. While it is possible that some of the graphs generated are not valid DOT files (the output is generated by drawing samples from GPT-2 using nucleus sampling), in our tests ~94\% of the generated graphs were valid DOT files.
The generated graphs can be thus be used with libraries like Graphviz or [networkx](https://networkx.github.io/) for downstream applications.

We also provide a simple wrapper over these graphs in ``src/temporal_graph.py``.

For example, the following script parses the output graph generated above.
```sh
python src/temporal_graph.py data/test_output.json data/test_out.png
```
![Sample Temporal Graph ><](data/test_output.png)

The generated graphs can also be visualized using [Edotor](https://edotor.net/?engine=dot#strict%20digraph%20%20%7B%0A%22The%20Organization%20asserted%20responsibility%22%20-%3E%20%22a%20United%20States%20Navy%20diver%20killed%22%20%20%5Blabel%3Dafter%5D%3B%0A%7D)


## Citation

```
@inproceedings{madaan-yang-2021-neural,
    title = "Neural Language Modeling for Contextualized Temporal Graph Generation",
    author = "Madaan, Aman  and Yang, Yiming",
    booktitle = "Proceedings of the 2021 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies",
    month = jun,
    year = "2021",
    address = "Online",
    publisher = "Association for Computational Linguistics",
    url = "https://www.aclweb.org/anthology/2021.naacl-main.67",
    pages = "864--881",
}
```
